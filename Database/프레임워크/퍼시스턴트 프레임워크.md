# 퍼시스턴스 프레임워크 (Persistence Framework)

## 개념

데이터의 **영속성(저장)** 을 관리하는 프레임워크

### 목적
- JDBC의 복잡함 해소
- 데이터베이스 작업 단순화
- 비즈니스 로직에 집중

## 주요 기능

1. **데이터 매핑**: 객체 ↔ 테이블 변환
2. **DB 연동**: 연결, 쿼리 실행, 결과 매핑
3. **트랜잭션 관리**: 일관성 보장
4. **캐시 관리**: 성능 최적화

## 종류

### 1. SQL Mapper

**특징**: SQL을 **직접 작성**하여 데이터 처리

**장점**:
- SQL 제어 가능
- 복잡한 쿼리 최적화 용이
- 학습 곡선 낮음

**단점**:
- SQL 의존적
- DB 변경 시 수정 필요

**예시**: MyBatis, JdbcTemplate
```xml
<!-- MyBatis -->
<select id="findUser" resultType="User">
    SELECT * FROM users WHERE id = #{id}
</select>
```

### 2. ORM (Object-Relational Mapping)

**특징**: 객체를 **자동으로** 테이블과 매핑

**장점**:
- SQL 작성 최소화
- DB 독립적
- 생산성 높음

**단점**:
- 복잡한 쿼리 처리 어려움
- 학습 곡선 높음
- 성능 튜닝 제한적

**예시**: JPA/Hibernate, Sequelize
```java
// JPA
@Entity
public class User {
    @Id
    private Long id;
    private String name;
}

// 사용
User user = entityManager.find(User.class, 1L);
```

## SQL Mapper vs ORM

| 구분 | SQL Mapper | ORM |
|------|-----------|-----|
| SQL 작성 | 직접 | 자동 생성 |
| 학습 난이도 | 낮음 | 높음 |
| 복잡한 쿼리 | 유리 | 불리 |
| DB 독립성 | 낮음 | 높음 |
| 생산성 | 중간 | 높음 |
| 예시 | MyBatis | JPA, Hibernate |

## 프레임워크 구조
```
퍼시스턴스 프레임워크
├── SQL Mapper
│   ├── MyBatis
│   └── JdbcTemplate
└── ORM
    ├── JPA (인터페이스)
    │   ├── Hibernate (구현체)
    │   ├── EclipseLink
    │   └── DataNucleus
    └── Sequelize (Node.js)
```

## 대표 프레임워크

### MyBatis (SQL Mapper)
```java
// Mapper 인터페이스
@Mapper
public interface UserMapper {
    @Select("SELECT * FROM users WHERE id = #{id}")
    User findById(Long id);
}
```

### JPA/Hibernate (ORM)
```java
// Repository
public interface UserRepository extends JpaRepository<User, Long> {
    List<User> findByName(String name);  // 메서드명으로 쿼리 자동 생성
}
```

## 선택 가이드

**SQL Mapper 선택 시**:
- SQL 제어 필요
- 복잡한 쿼리 많음
- 레거시 DB 연동
- 성능 최적화 중요

**ORM 선택 시**:
- 빠른 개발 필요
- 단순 CRUD 중심
- DB 변경 가능성
- 객체 중심 설계

## JDBC vs 퍼시스턴스 프레임워크

### JDBC (순수 자바)
```java
// 복잡하고 반복적
Connection conn = DriverManager.getConnection(url, user, password);
PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
pstmt.setLong(1, id);
ResultSet rs = pstmt.executeQuery();
User user = new User();
if (rs.next()) {
    user.setId(rs.getLong("id"));
    user.setName(rs.getString("name"));
}
rs.close();
pstmt.close();
conn.close();
```

### 퍼시스턴스 프레임워크
```java
// 간결하고 명확
User user = userRepository.findById(id);
```

## 장점

- **생산성**: 반복 코드 제거
- **유지보수**: 구조화된 코드
- **안정성**: 검증된 라이브러리
- **추상화**: DB 변경 용이

## 참고 자료

- [MyBatis 공식 문서](https://mybatis.org/mybatis-3/)
- [JPA 스펙](https://jcp.org/en/jsr/detail?id=338)
- [Hibernate 문서](https://hibernate.org/orm/documentation/)